<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="Technology,Novel,Essay,Hexo" />
  <meta name="author" content="wellmoonloft" />
  <meta name="subtitle" content="Connotation fatty refuses to lose weight" />  
  <meta name="description" content="Technology, Essay, Gossip" />
  <meta name="msvalidate.01" content="4504B006DB2A6062F644FCDD2FC0575B" />
  <title>How to use GitHub Action for automatic Hexo | Well Talk</title>
  <link rel="apple-touch-icon" href="https://s2.loli.net/2022/12/30/lV2YzG9s86yK3OB.jpg">
  <link rel="icon" href="https://s2.loli.net/2022/12/30/lV2YzG9s86yK3OB.jpg">
  <!-- jquery3.6 -->
  <script async src="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/js/jquery.min-3.6.js"></script>
  <!-- hexo site css -->
  <link async href="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.5/source/css/base-min.css" rel="stylesheet">
  <link async href="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/iconfont/iconfont-min.css" rel="stylesheet">
  <link async href="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/css/github-markdown-min.css" rel="stylesheet">
  <link async href="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/css/highlight-min.css" rel="stylesheet">  
  <!-- fancybox -->
  <link async href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" rel="stylesheet">  
  <script async src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>
  <script async src="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/js/fancybox.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R4XRTRGM56"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-R4XRTRGM56');
    </script>  
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/en/atom.xml" title="Well Talk" type="application/atom+xml">
</head>
<body>
  <div id="app">
  <div class="header">
  <div class="avatar">
    <a href="https://www.igerm.ee/en"><img src="https://s2.loli.net/2022/12/30/lV2YzG9s86yK3OB.jpg" alt=""></a>
  </div>
  <div class="navbar">
    <ul>
      <li class="nav-item" data-path="/en/"><a href="/en/">Experience</a></li>
      <li class="nav-item" data-path="/en/categories/essay/"><a href="/en/categories/essay/">Essay</a></li>
      <li class="nav-item" data-path="/en/categories/novel/"><a href="/en/categories/novel/">Novel</a></li>
      <li class="nav-item" data-path="/en/about/"><a href="/en/about/">About</a></li>
    </ul>
  </div>
</div>
<script>
  let navs = document.querySelectorAll('.nav-item');
  let pagePath = window.location.pathname;
  for (let nav of navs) {
    let navPath = nav.getAttribute("data-path");
    if (navPath && navPath === pagePath) {
      nav.className = "nav-item active";
    }
  }
</script>       
  <div class="flex-container">          
  <!-- 同时引入 post.ejs 和 index.ejs -->
  
<div class="container post-details" id="post-details">
  <div class="post-content">
    <div class="post-title">How to use GitHub Action for automatic Hexo</div>
    <div class="post-attach">
      <span class="post-pubtime">
        <i class="iconfont icon-edit" title="Update time"></i> 2021-04-07 13:45
      </span>
      <span class="post-pubtime">
        <i class="iconfont icon-updatetime" title="Update time"></i> 2022-11-30 10:23
      </span>
      <span class="post-count">≈ 1kWords</span>
      <span class="post-count">≈ 6Minutes</span>
    </div>
    <div class="markdown-body"><blockquote>
<p><strong>Note</strong></p>
<p>This article was automatically translated using Google</p>
</blockquote>
<blockquote>
<p><strong>Updated on 2022.11.30, the node-version version has been upgraded, using 12 will prompt the upgrade in the management background, although it can be used normally, but the checkout@v2 in the code is changed to v3, setup-node@v1 is changed to v3, node-version Just change it to 16</strong></p>
</blockquote>
<p>It has been 8 days since Hexo was set up, and it has become more and more comfortable to use, and the modified things have basically come to an end.</p>
<p>Today, in order to achieve a more perfect multi-language (including articles), I have to toss a bit. The plan has been thought about. Today, I will release Hexo to Github Action to prepare for the multi-language plan.</p>
<p>First of all, suppose that Hexo has been installed, and all the toss is almost done, then start to configure automatic deployment</p>
<p><a href="https://www.igerm.ee/en/experience/Use-Hexo-GitHub-Page-Typora-to-write-articles/">How to install Hexo and deploy to GitHub Pages here</a></p>
<p>First of all, since using Hexo, I believe you already have a warehouse for deploying Hexo Github Pages. Now we need to build another warehouse to store the original files of Hexo, which are the files in the root directory of your local Hexo. This step Using <code>VSCode</code> directly, you can directly <code>share</code> the project to Github</p>
<h3 id="Generate-key"><a href="#Generate-key" class="headerlink" title="Generate key"></a>Generate key</h3><p>Maybe people who use Hexo have already done this step, but I have been using vscode before, so I have not done this step. Now for automatic deployment, a new key is generated here to automatically deploy Hexo.</p>
<p>The following is the operation under macOS. The operation method under Linux is the same. Windows 10 users can install Ubuntu in the market and execute it afterwards:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C &quot;Hexo Deploy Key&quot; -f github-deploy-key -N &quot;&quot;</span><br></pre></td></tr></table></figure>

<p>This will generate two files in the current directory:</p>
<p>-github-deploy-key —— private key<br>-github-deploy-key.pub-public key</p>
<h3 id="GitHub-configuration-key"><a href="#GitHub-configuration-key" class="headerlink" title="GitHub configuration key"></a>GitHub configuration key</h3><p>Here put the <code>private key</code> in the code repository where the original Hexo files are stored, and use it when triggering Actions.</p>
<p>Put the <code>public key</code> in the code repository corresponding to GitHub Pages for writing during Hexo deployment.</p>
<h3 id="Configure-private-key"><a href="#Configure-private-key" class="headerlink" title="Configure private key"></a>Configure private key</h3><p>First open the repository where Hexo is saved on GitHub, visit <code>Settings -&gt; Secrets</code>, and select <code>New repository secret</code></p>
<p><img src="https://s2.loli.net/2022/12/30/iu8s2EZx6hmLRY7.png" alt="image-20210407125805861"></p>
<p>Fill in the name part: <code>HEXO_DEPLOY_KEY</code>, pay attention to the capitalization, this will be used by GitHub Actions Workflow later, ** must not be wrong. **</p>
<h3 id="Add-public-key"><a href="#Add-public-key" class="headerlink" title="Add public key"></a>Add public key</h3><p>Next, we need to access the warehouse where the webpage is stored, which is the warehouse after Hexo deployment, such as: <code>yourname.github.io</code>, visit <code>Settings -&gt; Deploy keys</code>, and then press <code>Add deploy key</code> to add a new The public key:</p>
<p><img src="https://s2.loli.net/2022/12/30/sInQUzm9vT5JAla.png" alt="image-20210407130033885"></p>
<p>Enter in the <code>Title</code>: <code>HEXO_DEPLOY_PUB</code>, of course, you can also fill in other custom names.</p>
<p>Paste the contents of the <code>github-deploy-key.pub</code> file in <code>Key</code>.</p>
<blockquote>
<p>Note: Be sure to check <code>Allow write access</code> to enable write access, otherwise the failure to write will result in deployment failure.</p>
</blockquote>
<h3 id="Create-Workflow"><a href="#Create-Workflow" class="headerlink" title="Create Workflow"></a>Create Workflow</h3><p>First create a new file in the Hexo warehouse: <code>.github/workflows/deploy.yml</code>, the file name can be taken by yourself, but it must be placed in the <code>.github/workflows</code> directory, the content of the file is as follows:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Hexo</span> <span class="string">Deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="string">-master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-18.04</span></span><br><span class="line">    <span class="attr">if:</span> <span class="string">github.event.repository.owner.id</span> <span class="string">==</span> <span class="string">github.event.sender.id</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="string">-name:</span> <span class="string">Checkout</span> <span class="string">source</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line">      <span class="string">-name:</span> <span class="string">Setup</span> <span class="string">Node.js</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&#x27;12&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="string">-name:</span> <span class="string">Setup</span> <span class="string">Hexo</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">ACTION_DEPLOY_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.HEXO_DEPLOY_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          mkdir -p ~/.ssh/</span></span><br><span class="line"><span class="string">          echo &quot;$ACTION_DEPLOY_KEY&quot;&gt; ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string">          chmod 700 ~/.ssh</span></span><br><span class="line"><span class="string">          chmod 600 ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string">          ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts</span></span><br><span class="line"><span class="string">          git config --global user.email &quot;john@doe.com&quot;</span></span><br><span class="line"><span class="string">          git config --global user.name &quot;John Doe&quot;</span></span><br><span class="line"><span class="string">          npm install hexo-cli -g</span></span><br><span class="line"><span class="string">          npm install</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="string">-name:</span> <span class="string">Deploy</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          hexo clean</span></span><br><span class="line"><span class="string">          hexo deploy</span></span><br></pre></td></tr></table></figure>

<p>To explain briefly, when we push content to the remote <code>master</code> branch, this Workflow will be triggered.</p>
<p>Use <code>ubuntu-latest</code> as the system of <code>hexo deploy</code>.</p>
<p>First execute <code>actions/checkout@v2</code> to check out the source code (this is also the code written by others), and then set to use the latest Node.js v12 LTS as the node interpreter.</p>
<p>The next step is to create SSH-related configuration files. Note that <code>secrets.HEXO_DEPLOY_KEY</code> corresponds to the private key we set before, so the name must not be mistaken.</p>
<p>Just replace the name and email address related to <code>git config</code> with your own.</p>
<p>The last step is to install Hexo CLI, all dependent modules and deployment.</p>
<h4 id="It-is-recommended-to-load-the-dependency-package-locally"><a href="#It-is-recommended-to-load-the-dependency-package-locally" class="headerlink" title="It is recommended to load the dependency package locally"></a>It is recommended to load the dependency package locally</h4><p>It should be noted here that I suggest that you use my method, which is to remove <code>npm install</code> and run <code>npm install</code> locally, and then <code>push</code> all dependent packages to the warehouse. This has two advantages:</p>
<ol>
<li><p>When updating frequently, save the time of downloading dependent packages (think if you only update a certain file, there is no need to download the dependent package again)</p>
</li>
<li><p>Due to my special needs, <a href="https://www.igerm.ee/en/experience/Hexo's-beautification-optimization-and-Lighthouse's-ultimate-tracking/">I need to remove a certain category of articles when paging</a>, so I modified the <code>hexo -generator-index</code> The code of this package, if you re-download, then the part I modified will not be implemented</p>
</li>
</ol>
<p>After the configuration is complete, try to push the code, and then you can check the operation in the <code>Actions</code> of the warehouse</p>
<p><img src="https://s2.loli.net/2022/12/30/WQBlS1v67aPtMTV.png" alt="image-20210407133226277"></p>
<h3 id="Pit-one-change-the-deploy-configuration-warehouse-address-to-git-mode"><a href="#Pit-one-change-the-deploy-configuration-warehouse-address-to-git-mode" class="headerlink" title="Pit one, change the deploy configuration warehouse address to git mode"></a>Pit one, change the deploy configuration warehouse address to git mode</h3><p>Make sure that there is a <code>GitHub Pages</code> configuration similar to the following in the <code>_config.yml</code> file:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">git@github.com:wellmoonloft/en.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note: If you use http, there will be problems when publishing later</p>
</blockquote>
<h3 id="Pit-two-remember-not-to-delete-the-time-zone-in-the-automatic-deployment-configuration-file"><a href="#Pit-two-remember-not-to-delete-the-time-zone-in-the-automatic-deployment-configuration-file" class="headerlink" title="Pit two, remember not to delete the time zone in the automatic deployment configuration file"></a>Pit two, remember not to delete the time zone in the automatic deployment configuration file</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br></pre></td></tr></table></figure>

<p>If you don’t add this, when someone in China publishes an article, the displayed article time will be exactly 8 hours away from your <code>date</code> time</p>
</div>
      
        <div class="prev-or-next">
          <div class="post-foot-prev">
              <a href="/en/experience/The-perfect-Hexo-multilingual-solution/" target="_self">
                <i class="iconfont icon-chevronleft"></i>  
                <span>The perfect Hexo multilingual solution</span> 
              </a>
          </div>
          <div class="post-foot-next">
              <a href="/en/experience/Wrong-address-when-using-Hexo-full-text-search/" target="_self">
                <span>Wrong address when using Hexo full text search</span>
                <i class="iconfont icon-chevronright"></i>             
              </a> 
          </div>
        </div>
      
    </div>
    
<div class="post-catalog" id="catalog">
  <div class="title">Contents</div>
  <div class="catalog-content">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Generate-key"><span class="toc-text">Generate key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GitHub-configuration-key"><span class="toc-text">GitHub configuration key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configure-private-key"><span class="toc-text">Configure private key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Add-public-key"><span class="toc-text">Add public key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-Workflow"><span class="toc-text">Create Workflow</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#It-is-recommended-to-load-the-dependency-package-locally"><span class="toc-text">It is recommended to load the dependency package locally</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pit-one-change-the-deploy-configuration-warehouse-address-to-git-mode"><span class="toc-text">Pit one, change the deploy configuration warehouse address to git mode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pit-two-remember-not-to-delete-the-time-zone-in-the-automatic-deployment-configuration-file"><span class="toc-text">Pit two, remember not to delete the time zone in the automatic deployment configuration file</span></a></li></ol>
  </div>
</div>
<script async src="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/js/catalog.js"></script>


    <div class="comments-container">
  <script src="https://utteranc.es/client.js"
        repo="wellmoonloft/repo_wellmoonloft"
        issue-term="pathname"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>
</div>
  </div>

  <div class="footer">
  <div class="social">
    <ul>
      <li><a title="rss" href="/en/atom.xml"><i class="iconfont icon-rss"></i></a></li>
    </ul>
  </div>
  <div class="footer-more">
      <a href="https://www.igerm.ee/en/">Copyright © wellmoonloft 2024</a>  
  </div><div class="footer-more">
      <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges ｜ Powered by Hexo</a>  
  </div>
</div>
  </div>
  <div style="position: fixed;right: 2.2rem;top: 2.2rem;font-weight: bold;font-size: 1.6rem;">
  <a href="https://www.igerm.ee"> CN</a>
  <a href="https://www.igerm.ee/jp"> JP</a>
  <a href="https://www.igerm.ee/en"> EN</a>
  </div><div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>
<script async src="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/js/backtoTop.js"></script>
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)"><i class="iconfont icon-search"></i></a>
  </div>
  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)"><i class="iconfont icon-search"></i></a>
        </span><input type="text" class="search-input" id="search-input" placeholder="Search...">
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)"><i class="iconfont icon-close"></i></a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>
  <script async src="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.6/source/js/search.js"></script>
  </div>
</body>
</html>