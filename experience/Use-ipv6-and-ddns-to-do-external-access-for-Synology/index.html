<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="Technology,Novel,Essay,Hexo" />
  <meta name="author" content="wellmoonloft" />
  <meta name="subtitle" content="Connotation fatty refuses to lose weight" />  
  <meta name="description" content="Technology, Essay, Gossip" />
  <meta name="msvalidate.01" content="4504B006DB2A6062F644FCDD2FC0575B" />
  <title>Use ipv6 and ddns to do external access for Synology | Well Talk</title>
  <link rel="apple-touch-icon" href="https://s2.loli.net/2022/12/30/lV2YzG9s86yK3OB.jpg">
  <link rel="icon" href="https://s2.loli.net/2022/12/30/lV2YzG9s86yK3OB.jpg">
  <!-- jquery3.6 -->
  <script async src="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/js/jquery.min-3.6.js"></script>
  <!-- hexo site css -->
  <link async href="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.5/source/css/base-min.css" rel="stylesheet">
  <link async href="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/iconfont/iconfont-min.css" rel="stylesheet">
  <link async href="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/css/github-markdown-min.css" rel="stylesheet">
  <link async href="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/css/highlight-min.css" rel="stylesheet">  
  <!-- fancybox -->
  <link async href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" rel="stylesheet">  
  <script async src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>
  <script async src="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/js/fancybox.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R4XRTRGM56"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-R4XRTRGM56');
    </script>  
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/en/atom.xml" title="Well Talk" type="application/atom+xml">
</head>
<body>
  <div id="app">
  <div class="header">
  <div class="avatar">
    <a href="https://www.igerm.ee/en"><img src="https://s2.loli.net/2022/12/30/lV2YzG9s86yK3OB.jpg" alt=""></a>
  </div>
  <div class="navbar">
    <ul>
      <li class="nav-item" data-path="/en/"><a href="/en/">Experience</a></li>
      <li class="nav-item" data-path="/en/categories/essay/"><a href="/en/categories/essay/">Essay</a></li>
      <li class="nav-item" data-path="/en/categories/novel/"><a href="/en/categories/novel/">Novel</a></li>
      <li class="nav-item" data-path="/en/about/"><a href="/en/about/">About</a></li>
    </ul>
  </div>
</div>
<script>
  let navs = document.querySelectorAll('.nav-item');
  let pagePath = window.location.pathname;
  for (let nav of navs) {
    let navPath = nav.getAttribute("data-path");
    if (navPath && navPath === pagePath) {
      nav.className = "nav-item active";
    }
  }
</script>       
  <div class="flex-container">          
  <!-- 同时引入 post.ejs 和 index.ejs -->
  
<div class="container post-details" id="post-details">
  <div class="post-content">
    <div class="post-title">Use ipv6 and ddns to do external access for Synology</div>
    <div class="post-attach">
      <span class="post-pubtime">
        <i class="iconfont icon-edit" title="Update time"></i> 2022-12-13 12:47
      </span>
      <span class="post-count">≈ 1.2kWords</span>
      <span class="post-count">≈ 7Minutes</span>
    </div>
    <div class="markdown-body"><blockquote>
<p><strong>Note</strong></p>
<p>This article was automatically translated using Google</p>
</blockquote>
<p>The easiest one is definitely quickconnect, but the account must be migrated to the country, which means that user information, address links, etc. must be stored in the country. I am very disgusted with this point since Apple put the data on the cloud in Guizhou. Therefore, I now use 5G space to synchronize some configuration information on icloud, and put all important files and photos on my nas (this is also the reason why I bought nas in the first place)</p>
<p>Although we are not trying to do anything illegal, but your messing around with my privacy is pure nonsense. There are many ways to prevent Internet fraud, various real-name and various monitoring, and I have not seen much less domestic fraud, so I decisively migrated Delete the device in the domestic account, and then re-register an account, ready to do external network access by yourself</p>
<p>After logging in to the new account, you will find that there is a prompt in quickconnect suggesting that you migrate, hehe, give them a smile and experience it for yourself</p>
<p><img src="https://s2.loli.net/2022/12/30/elRXEcQd1thVvoz.jpg" alt="1670905069658"></p>
<h3 id="Get-ipv6-address"><a href="#Get-ipv6-address" class="headerlink" title="Get ipv6 address"></a>Get ipv6 address</h3><p>Well, let’s get far, the premise of doing ddns is that you have an external network IP. Of course, at least Beijing has not allocated it to individuals, but it costs 100 yuan a month to open a value-added service, and you can share one, which is pure nonsense. What should have been given to me in the first place, made up a bunch of reasons not to give it, and then opened an opening to collect money. This is a typical robber’s thinking.</p>
<p>But fortunately, there are plenty of ipv6 addresses. At least Beijing should have all allocated them. First, change the optical modem to bridge connection (I rooted and changed it by myself four or five years ago. You may need to search for the tutorial), and then Enter the router and turn on ipv6, select Native mode, and select automatic configuration for ipv6 dns, <strong>Also remember to turn off the ipv6 firewall</strong></p>
<p>After confirmation, you can see in the group that you have obtained the ipv6 address starting with 2408. At the same time, all the devices under your router should be able to obtain the ipv6 address.</p>
<p><img src="https://s2.loli.net/2022/12/30/hq1xuRmDcBsSfIv.jpg" alt="1670904756888"></p>
<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>Compared with people who play nas, they already have their own domain names. The easiest registration is Ali and Tencent, a one-stop service, registration plus analysis. But in fact, you can transfer the domain name to other platforms to manage and resolve it. I have been using <a target="_blank" rel="noopener" href="https://freedns.afraid.org/">freedns</a>. The interface is simple but extremely reliable. The most important thing is to configure ddns extremely simple</p>
<p>Let me say one more thing here, in order to monitor all kinds of monsters, a group of idiots used to give China the authority to issue ssl certificates, but they made it up by themselves. The reason is that they hijacked dns with fake certificates and were discovered. It’s so ridiculous. , so if you go to all government websites now, you will find that their certificates are all issued by the United States, hahahahaha! !</p>
<p><img src="https://s2.loli.net/2022/12/30/wBXItQWcTaKz531.jpg" alt="1670905482299"></p>
<p>First do a domain name analysis, choose AAAA to analyze the ipv6 address and save it</p>
<p>Then click <a target="_blank" rel="noopener" href="https://freedns.afraid.org/dynamic/">Dynamic DNS</a> on the left to enter the configuration page, and click the dynamic update interface above</p>
<p><img src="https://s2.loli.net/2022/12/30/eTPq1RLQcAE7DMa.jpg" alt="1670905618484"></p>
<p>Then you can choose the domain name to enable DDNS, activate it, and an upload link with a dynamic password will appear later, just copy it.</p>
<p><img src="https://s2.loli.net/2022/12/30/HPj4dBcvolfMnrZ.jpg" alt="1670905719483"></p>
<h3 id="Automatically-upload-new-addresses"><a href="#Automatically-upload-new-addresses" class="headerlink" title="Automatically upload new addresses"></a>Automatically upload new addresses</h3><p>If you are also using freedns, the good news is that you don’t need to use the ddns that comes with Synology (because you can’t upload ipv6 addresses in it), and you don’t need to use the famous ddns-go, you just need to open the text editor and write A shell file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">curl http://v6.sync.afraid.org/u/**************</span><br></pre></td></tr></table></figure>

<p>It’s as simple as that, after curl is the upload address you just copied</p>
<p>Then save it as a .sh file (remember the utf-8 encoding), and put it in any path of Synology</p>
<p>Enter the control panel, pull down to the bottom and there is a scheduled task. The name and scheduled time are in front of it. I chose to execute it every 10 minutes from 0:00 to 11:50 every day. Run the command here and directly bash the script you just saved. The location is enough</p>
<p><img src="https://s2.loli.net/2022/12/30/QsnHzfaFXMC4bkR.jpg" alt="1670906114629"></p>
<p>Later, you can open a task execution log, but you can open this kind of thing to take a look, so just close it, there are quite a lot of log files once every ten minutes.</p>
<h3 id="Apply-for-an-SSL-certificate"><a href="#Apply-for-an-SSL-certificate" class="headerlink" title="Apply for an SSL certificate"></a>Apply for an SSL certificate</h3><p>You don’t need to go to other places to apply. The certificate application tool that comes with Synology can apply for the free certificate of Let’s Encrypt. You can add it in the control panel-security-certificate. After the application is complete, set the certificate as the default certificate and enter Settings, re-select all the certificates inside, and now you can use <a target="_blank" rel="noopener" href="https://custom/">https://custom</a> domain name to access your group on the external network</p>
<p><img src="https://s2.loli.net/2022/12/30/ed5YAtOXlDvyG9q.jpg" alt="1670906383630"></p>
<h3 id="Use-certificates-for-applications-in-Docker"><a href="#Use-certificates-for-applications-in-Docker" class="headerlink" title="Use certificates for applications in Docker"></a>Use certificates for applications in Docker</h3><p>With the certificate, there are actually two ways to enable https support for applications in docker:</p>
<ol>
<li><p>Import certificates for different applications and open them in their own way;</p>
</li>
<li><p>Use the reverse proxy server that comes with Synology</p>
</li>
</ol>
<p>It is strongly recommended to use a reverse proxy here. You don’t need to build an nginx yourself, because the reverse proxy server version 7.0 is really easy to use</p>
<p><img src="https://s2.loli.net/2022/12/30/lzvZ8j6Xw3DF1uq.jpg" alt="1670951541739"></p>
<p>Directly in the control panel - login portal - advanced - reverse proxy server - add, and then fill in the application that needs to be reverse proxy. There is a great advantage of using the built-in reverse proxy server here, no need Then deal with the certificate, after the selection is completed, Synology will automatically load the certificate</p>
<p>Then add a WebSocket in the custom title and save it directly</p>
<h3 id="Special-formulation-of-Home-Assistant"><a href="#Special-formulation-of-Home-Assistant" class="headerlink" title="Special formulation of Home Assistant"></a>Special formulation of Home Assistant</h3><p>When configuring the reverse proxy in the latest version of Home Assistant, for security needs, you must add an authorization information in the <code>configuration.yaml</code> file, and add the intranet IP of Synology, otherwise the reverse proxy will fail</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">use_x_forwarded_for:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">trusted_proxies:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.31</span><span class="number">.241</span> <span class="comment"># Add the IP address of the proxy server</span></span><br></pre></td></tr></table></figure>

<h3 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h3><p>After all, the ipv6 firewall of the router is turned off, so it is recommended to enable two-factor authentication. Download a SynologySecure Signin on the mobile phone. No more re-entering tokens</p>
<p>Then set the original port of the application in the firewall so that only the fixed ip of Synology can be accessed, which is a little more secure (it’s not a big problem, it’s mainly anti-scanning, and it’s definitely risky to throw it on the public network. I did everything, it doesn’t matter)</p>
</div>
      
        <div class="prev-or-next">
          <div class="post-foot-prev">
              <a href="/en/experience/Update-hexo-to-v6-3-0/" target="_self">
                <i class="iconfont icon-chevronleft"></i>  
                <span>Update hexo to v6.3.0</span> 
              </a>
          </div>
          <div class="post-foot-next">
              <a href="/en/experience/Add-utterances-comments-to-hexo/" target="_self">
                <span>Add utterances comments to hexo</span>
                <i class="iconfont icon-chevronright"></i>             
              </a> 
          </div>
        </div>
      
    </div>
    
<div class="post-catalog" id="catalog">
  <div class="title">Contents</div>
  <div class="catalog-content">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-ipv6-address"><span class="toc-text">Get ipv6 address</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS"><span class="toc-text">DNS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Automatically-upload-new-addresses"><span class="toc-text">Automatically upload new addresses</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apply-for-an-SSL-certificate"><span class="toc-text">Apply for an SSL certificate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Use-certificates-for-applications-in-Docker"><span class="toc-text">Use certificates for applications in Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Special-formulation-of-Home-Assistant"><span class="toc-text">Special formulation of Home Assistant</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Notice"><span class="toc-text">Notice</span></a></li></ol>
  </div>
</div>
<script async src="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/js/catalog.js"></script>


    <div class="comments-container">
  <script src="https://utteranc.es/client.js"
        repo="wellmoonloft/repo_wellmoonloft"
        issue-term="pathname"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>
</div>
  </div>

  <div class="footer">
  <div class="social">
    <ul>
      <li><a title="rss" href="/en/atom.xml"><i class="iconfont icon-rss"></i></a></li>
    </ul>
  </div>
  <div class="footer-more">
      <a href="https://www.igerm.ee/en/">Copyright © wellmoonloft 2024</a>  
  </div><div class="footer-more">
      <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges ｜ Powered by Hexo</a>  
  </div>
</div>
  </div>
  <div style="position: fixed;right: 2.2rem;top: 2.2rem;font-weight: bold;font-size: 1.6rem;">
  <a href="https://www.igerm.ee"> CN</a>
  <a href="https://www.igerm.ee/jp"> JP</a>
  <a href="https://www.igerm.ee/en"> EN</a>
  </div><div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>
<script async src="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.4/source/js/backtoTop.js"></script>
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)"><i class="iconfont icon-search"></i></a>
  </div>
  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)"><i class="iconfont icon-search"></i></a>
        </span><input type="text" class="search-input" id="search-input" placeholder="Search...">
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)"><i class="iconfont icon-close"></i></a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>
  <script async src="https://cdn.jsdelivr.net/gh/wellmoonloft/peach@v0.1.6/source/js/search.js"></script>
  </div>
</body>
</html>